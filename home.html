<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title id="txt-title">ุงูุฑุฆูุณูุฉ - ุชูููู</title>
    <link rel="stylesheet" href="css/home.css">
    
    <!-- ููุชุจุงุช Firebase -->
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-firestore-compat.js"></script>
</head>
<body>

    <header>
        <div class="user-controls">
            <button onclick="logout()" class="logout-btn" id="btn-logout">ุชุณุฌูู ุฎุฑูุฌ</button>
            <div class="lang-switch">
                <span onclick="setLanguage('ar')" style="cursor:pointer; font-weight:bold;">ุนุฑุจู</span> | 
                <span onclick="setLanguage('en')" style="cursor:pointer; font-weight:bold;">EN</span>
            </div>
        </div>
        <h2 id="txt-header">ููุญุฉ ุงูุชุญูู</h2>
    </header>

    <main class="container">
        <div class="welcome-section">
            <h1 id="txt-welcome">ุฃููุงู ุจู ูู ูุธุงู ุชูููู ุงูููุญุฏ</h1>
            <p id="userEmail" style="color: #2a5298; font-weight: bold;"></p>
        </div>

        <div class="cards-grid">
            <!-- ูุงุฑุช ุญุงุณุจุฉ ุงููุฑูุถ (ูุธูุฑ ูููู) -->
            <div class="card" onclick="location.href='calculator.html'">
                <div class="icon">๐ฐ</div>
                <h3 id="txt-calc">ุญุงุณุจุฉ ุงููุฑูุถ</h3>
                <p id="sub-calc">ุญุณุงุจ ุงูููุงุฆุฏ ูุงูุฑุณูู ุงูุฅุฏุงุฑูุฉ</p>
            </div>

            <!-- ูุงุฑุช ุดุคูู ุงูููุธููู (ูุธูุฑ ูููู) -->
            <div class="card" onclick="location.href='hr-solution.html'">
                <div class="icon">๐</div>
                <h3 id="txt-hr">ุดุคูู ุงูููุธููู</h3>
                <p id="sub-hr">ุทูุจ ุฅุฌุงุฒุงุช ูุฃุฐููุงุช</p>
            </div>

            <!-- ูุงุฑุช ุงููุฑูุน (ูุธูุฑ ูููู) -->
            <div class="card" onclick="location.href='branches.html'">
                <div class="icon">๐</div>
                <h3 id="txt-branches">ุงููุฑูุน</h3>
                <p id="sub-branches">ุนูุงููู ูููููุดู ุงููุฑูุน</p>
            </div>

            <!-- ูุงุฑุช ููุญุฉ ุชุญูู ุงููุฏูุฑ (ูุธูุฑ ูููุฏูุฑ ูุงูู HR ููุท) -->
            <div id="manager-card" class="card" style="display: none; border: 2px solid #27ae60;" onclick="location.href='manager-dashboard.html'">
                <div class="icon">๐</div>
                <h3 id="txt-mgr-dash">ููุญุฉ ุชุญูู ุงููุฏูุฑ</h3>
                <p id="sub-mgr-dash">ูุฑุงุฌุนุฉ ุทูุจุงุช ุงูููุธููู</p>
            </div>

            <!-- ูุงุฑุช ููุญุฉ ุชุญูู ุงูู HR (ูุธูุฑ ููู HR ููุท) -->
            <div id="hr-admin-card" class="card" style="display: none; border: 2px solid #e67e22;" onclick="location.href='hr-dashboard.html'">
                <div class="icon">๐ข</div>
                <h3 id="txt-hr-dash">ููุญุฉ ุชุญูู ุงูู HR</h3>
                <p id="sub-hr-dash">ุฅุฏุงุฑุฉ ุงูููุธููู ูุงูุชูุงุฑูุฑ</p>
            </div>
        </div>
    </main>

    <!-- ุงููููุงุช ุงูุจุฑูุฌูุฉ -->
    <script src="js/firebase-config.js"></script>
    <script src="js/lang-manager.js"></script>
    <script src="js/auth.js"></script>

    <script>
        // 1. ูุธุงู ุงูุชุฑุฌูุฉ (updatePageContent)
        function updatePageContent(lang) {
            const translations = {
                ar: {
                    title: "ุงูุฑุฆูุณูุฉ - ุชูููู",
                    header: "ููุญุฉ ุงูุชุญูู",
                    welcome: "ุฃููุงู ุจู ูู ูุธุงู ุชูููู ุงูููุญุฏ",
                    logout: "ุชุณุฌูู ุฎุฑูุฌ",
                    calc: "ุญุงุณุจุฉ ุงููุฑูุถ",
                    subCalc: "ุญุณุงุจ ุงูููุงุฆุฏ ูุงูุฑุณูู",
                    hr: "ุดุคูู ุงูููุธููู",
                    subHr: "ุฅุฌุงุฒุงุช ูุฃุฐููุงุช",
                    branches: "ุงููุฑูุน",
                    subBranches: "ุงูุนูุงููู ูุงูููููุดู",
                    mgrDash: "ููุญุฉ ุชุญูู ุงููุฏูุฑ",
                    subMgrDash: "ูุฑุงุฌุนุฉ ุงูุทูุจุงุช",
                    hrDash: "ููุญุฉ ุชุญูู ุงูู HR",
                    subHrDash: "ุฅุฏุงุฑุฉ ุงููุธุงู ูุงูุชูุงุฑูุฑ"
                },
                en: {
                    title: "Home - Tamkeen",
                    header: "Dashboard",
                    welcome: "Welcome to Tamkeen Unified System",
                    logout: "Logout",
                    calc: "Loan Calculator",
                    subCalc: "Interests & Admin Fees",
                    hr: "HR Solution",
                    subHr: "Leaves & Permissions",
                    branches: "Branches",
                    subBranches: "Addresses & Location",
                    mgrDash: "Manager Dashboard",
                    subMgrDash: "Review Requests",
                    hrDash: "HR Admin Dashboard",
                    subHrDash: "System Admin & Reports"
                }
            };

            const t = translations[lang];
            
            // ุชุญุฏูุซ ูู ุงููุตูุต ูู ุงูุตูุญุฉ
            if(document.getElementById('txt-title')) document.getElementById('txt-title').innerText = t.title;
            if(document.getElementById('txt-header')) document.getElementById('txt-header').innerText = t.header;
            if(document.getElementById('txt-welcome')) document.getElementById('txt-welcome').innerText = t.welcome;
            if(document.getElementById('btn-logout')) document.getElementById('btn-logout').innerText = t.logout;
            if(document.getElementById('txt-calc')) document.getElementById('txt-calc').innerText = t.calc;
            if(document.getElementById('sub-calc')) document.getElementById('sub-calc').innerText = t.subCalc;
            if(document.getElementById('txt-hr')) document.getElementById('txt-hr').innerText = t.hr;
            if(document.getElementById('sub-hr')) document.getElementById('sub-hr').innerText = t.subHr;
            if(document.getElementById('txt-branches')) document.getElementById('txt-branches').innerText = t.branches;
            if(document.getElementById('sub-branches')) document.getElementById('sub-branches').innerText = t.subBranches;
            if(document.getElementById('txt-mgr-dash')) document.getElementById('txt-mgr-dash').innerText = t.mgrDash;
            if(document.getElementById('sub-mgr-dash')) document.getElementById('sub-mgr-dash').innerText = t.subMgrDash;
            if(document.getElementById('txt-hr-dash')) document.getElementById('txt-hr-dash').innerText = t.hrDash;
            if(document.getElementById('sub-hr-dash')) document.getElementById('sub-hr-dash').innerText = t.subHrDash;
        }

        // 2. ููุฏ ูุญุต ุงูุตูุงุญูุงุช (Role-Based Access)
        firebase.auth().onAuthStateChanged((user) => {
            if (user) {
                document.getElementById('userEmail').innerText = user.email;

                // ุงูุชูุฌู ูุฌุฏูู Users ููุนุฑูุฉ ุงูุฑุชุจุฉ
                firebase.firestore().collection("Users").doc(user.email).get().then((doc) => {
                    if (doc.exists) {
                        const role = doc.data().role;
                        console.log("ุชู ุงูุชุฃูุฏ ูู ุงูุฑุชุจุฉ:", role);

                        // ุฅุธูุงุฑ ุงููุฑูุช ุจูุงุกู ุนูู ุงูุฑุชุจุฉ
                        if (role === 'manager') {
                            document.getElementById('manager-card').style.display = 'block';
                        } else if (role === 'hr') {
                            document.getElementById('manager-card').style.display = 'block';
                            document.getElementById('hr-admin-card').style.display = 'block';
                        }
                    } else {
                        console.error("ุงููุณุชุฎุฏู ูุณุฌู ุฏุฎูู ููู ููุณ ูู ููู ูู ุฌุฏูู Users");
                        alert("ุฎุทุฃ ูู ููู ุงูุตูุงุญูุงุชุ ูุฑุฌู ูุฑุงุฌุนุฉ ุงูู HR");
                        logout(); // ูุฎุฑุฌู ูู ูููุด ุตูุงุญูุงุช ุนุดุงู ุงูุฃูุงู
                    }
                }).catch((error) => {
                    console.error("ุฎุทุฃ ูู ุฌูุจ ุจูุงูุงุช ุงูุตูุงุญูุงุช:", error);
                });
            } else {
                window.location.href = "index.html";
            }
        });
    </script>
</body>
</html>
