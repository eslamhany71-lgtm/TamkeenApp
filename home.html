<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title id="txt-title">ุงูุฑุฆูุณูุฉ - ุชูููู</title>
    <link rel="stylesheet" href="css/style.css">
    
    <!-- ููุชุจุงุช Firebase -->
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-firestore-compat.js"></script>
</head>
<body>

    <header>
        <div class="user-controls">
            <button onclick="logout()" class="logout-btn" id="btn-logout">ุชุณุฌูู ุฎุฑูุฌ</button>
            <div class="lang-switch">
                <span onclick="setLanguage('ar')" style="cursor:pointer">ุนุฑุจู</span> | 
                <span onclick="setLanguage('en')" style="cursor:pointer">EN</span>
            </div>
        </div>
        <h2 id="txt-header">ููุญุฉ ุงูุชุญูู</h2>
    </header>

    <main class="container">
        <div class="welcome-section">
            <h1 id="txt-welcome">ุฃููุงู ุจู ูู ูุธุงู ุชูููู</h1>
            <p id="userEmail" style="color: #2a5298; font-weight: bold;"></p>
        </div>

        <div class="cards-grid">
            <!-- ูุงุฑุช ุญุงุณุจุฉ ุงููุฑูุถ (ูุธูุฑ ูููู) -->
            <div class="card" onclick="location.href='calculator.html'">
                <div class="icon">๐ฐ</div>
                <h3 id="txt-calc">ุญุงุณุจุฉ ุงููุฑูุถ</h3>
                <p id="sub-calc">ุญุณุงุจ ุงูููุงุฆุฏ ูุงูุฑุณูู ุงูุฅุฏุงุฑูุฉ</p>
            </div>

            <!-- ูุงุฑุช ุดุคูู ุงูููุธููู (ูุธูุฑ ูููู) -->
            <div class="card" onclick="location.href='hr-solution.html'">
                <div class="icon">๐</div>
                <h3 id="txt-hr">ุงูุฎุฏูุงุช ุงูุฐุงุชูุฉ (HR)</h3>
                <p id="sub-hr">ุทูุจ ุฅุฌุงุฒุงุช ูุฃุฐููุงุช</p>
            </div>

            <!-- ูุงุฑุช ุงููุฑูุน (ูุธูุฑ ูููู) -->
            <div class="card" onclick="location.href='branches.html'">
                <div class="icon">๐</div>
                <h3 id="txt-branches">ุงููุฑูุน</h3>
                <p id="sub-branches">ุนูุงููู ูููููุดู ุงููุฑูุน</p>
            </div>

            <!-- ูุงุฑุช ููุญุฉ ุชุญูู ุงููุฏูุฑ (ูุฎูู ููุธูุฑ ูููุฏูุฑ ูุงูู HR ููุท) -->
            <div id="manager-card" class="card admin-card" style="display: none; border: 2px solid #27ae60;" onclick="location.href='manager-dashboard.html'">
                <div class="icon">๐</div>
                <h3 id="txt-mgr-dash">ููุญุฉ ุชุญูู ุงููุฏูุฑ</h3>
                <p id="sub-mgr-dash">ูุฑุงุฌุนุฉ ุทูุจุงุช ุงูููุธููู (ููุงููุฉ/ุฑูุถ)</p>
            </div>

            <!-- ูุงุฑุช ููุญุฉ ุชุญูู ุงูู HR (ูุฎูู ููุธูุฑ ููู HR ููุท) -->
            <div id="hr-admin-card" class="card admin-card" style="display: none; border: 2px solid #e67e22;" onclick="location.href='hr-dashboard.html'">
                <div class="icon">๐ข</div>
                <h3 id="txt-hr-dash">ุฅุฏุงุฑุฉ ุงูููุงุฑุฏ ุงูุจุดุฑูุฉ</h3>
                <p id="sub-hr-dash">ุงูุชุญูู ูู ุงูุทูุจุงุช ูุงูุชูุงุฑูุฑ ุงูููุงุฆูุฉ</p>
            </div>
        </div>
    </main>

    <!-- ุฑุจุท ุงููููุงุช ุงูุจุฑูุฌูุฉ -->
    <script src="js/firebase-config.js"></script>
    <script src="js/lang-manager.js"></script> <!-- ููู ูุฏูุฑ ุงููุบุฉ ุงููู ุงุชูููุง ุนููู -->
    <script src="js/auth.js"></script>
    <script src="js/home.js"></script>

    <script>
        // ุฏุงูุฉ ุงูุชุฑุฌูุฉ ุงูุฎุงุตุฉ ุจุตูุญุฉ ุงูู Home
        function updatePageContent(lang) {
            const translations = {
                ar: {
                    title: "ุงูุฑุฆูุณูุฉ - ุชูููู",
                    header: "ููุญุฉ ุงูุชุญูู",
                    welcome: "ุฃููุงู ุจู ูู ูุธุงู ุชูููู",
                    logout: "ุชุณุฌูู ุฎุฑูุฌ",
                    calc: "ุญุงุณุจุฉ ุงููุฑูุถ",
                    subCalc: "ุญุณุงุจ ุงูููุงุฆุฏ ูุงูุฑุณูู ุงูุฅุฏุงุฑูุฉ",
                    hr: "ุงูุฎุฏูุงุช ุงูุฐุงุชูุฉ (HR)",
                    subHr: "ุทูุจ ุฅุฌุงุฒุงุช ูุฃุฐููุงุช",
                    branches: "ุงููุฑูุน",
                    subBranches: "ุนูุงููู ูููููุดู ุงููุฑูุน",
                    mgrDash: "ููุญุฉ ุชุญูู ุงููุฏูุฑ",
                    subMgrDash: "ูุฑุงุฌุนุฉ ุทูุจุงุช ุงูููุธููู",
                    hrDash: "ุฅุฏุงุฑุฉ ุงูููุงุฑุฏ ุงูุจุดุฑูุฉ",
                    subHrDash: "ุงูุชุญูู ูู ุงูุทูุจุงุช ูุงูุชูุงุฑูุฑ"
                },
                en: {
                    title: "Home - Tamkeen",
                    header: "Dashboard",
                    welcome: "Welcome to Tamkeen System",
                    logout: "Logout",
                    calc: "Loan Calculator",
                    subCalc: "Calculate interests and admin fees",
                    hr: "HR Self-Service",
                    subHr: "Request leaves and permissions",
                    branches: "Branches",
                    subBranches: "Addresses and locations",
                    mgrDash: "Manager Dashboard",
                    subMgrDash: "Review employee requests",
                    hrDash: "HR Administration",
                    subHrDash: "Full control and reports"
                }
            };

            const t = translations[lang];
            document.getElementById('txt-title').innerText = t.title;
            document.getElementById('txt-header').innerText = t.header;
            document.getElementById('txt-welcome').innerText = t.welcome;
            document.getElementById('btn-logout').innerText = t.logout;
            document.getElementById('txt-calc').innerText = t.calc;
            document.getElementById('sub-calc').innerText = t.subCalc;
            document.getElementById('txt-hr').innerText = t.hr;
            document.getElementById('sub-hr').innerText = t.subHr;
            document.getElementById('txt-branches').innerText = t.branches;
            document.getElementById('sub-branches').innerText = t.subBranches;
            document.getElementById('txt-mgr-dash').innerText = t.mgrDash;
            document.getElementById('sub-mgr-dash').innerText = t.subMgrDash;
            document.getElementById('txt-hr-dash').innerText = t.hrDash;
            document.getElementById('sub-hr-dash').innerText = t.subHrDash;
        }

        // ุงูููุฏ ุงููู ุจูุชุญูู ูู ุงูุตูุงุญูุฉ ูููุชุญ ุงููุฑูุช
        firebase.auth().onAuthStateChanged((user) => {
            if (user) {
                document.getElementById('userEmail').innerText = user.email;

                // ุงูุจุญุซ ุนู ุฏูุฑ ุงูููุธู ูู Firestore
                firebase.firestore().collection("Users").doc(user.email).get().then((doc) => {
                    if (doc.exists) {
                        const userData = doc.data();
                        const role = userData.role;

                        if (role === 'manager') {
                            document.getElementById('manager-card').style.display = 'block';
                        } 
                        else if (role === 'hr') {
                            document.getElementById('manager-card').style.display = 'block';
                            document.getElementById('hr-admin-card').style.display = 'block';
                        }
                    } else {
                        console.log("ูุฐุง ุงููุณุชุฎุฏู ููุณ ูู ุฏูุฑ ูุญุฏุฏ ูู ุฌุฏูู Users");
                    }
                }).catch((error) => {
                    console.log("ุฎุทุฃ ูู ุฌูุจ ุงูุตูุงุญูุงุช:", error);
                });
            } else {
                window.location.href = "index.html";
            }
        });
    </script>
</body>
</html>
