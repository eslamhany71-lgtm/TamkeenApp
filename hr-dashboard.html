<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title id="txt-title">ูุธุงู ุชูููู | ููุญุฉ ุชุญูู HR</title>
    
    <!-- ุฎุทูุท ูุชูููุงุช ุญุฏูุซุฉ -->
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="css/hr-admin.css">
    
    <!-- ููุชุจุฉ ุงูุฑุณูู ุงูุจูุงููุฉ -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <!-- ููุชุจุงุช Firebase -->
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-firestore-compat.js"></script>
</head>
<body>

    <header class="hr-header">
        <div class="header-main">
            <div class="header-right">
                <button onclick="location.href='home.html'" class="btn-back">
                    <span class="icon">โฌ</span> <span id="btn-back-txt">ุฑุฌูุน</span>
                </button>
                <div class="lang-toggle">
                    <span onclick="setLanguage('ar')">AR</span> | <span onclick="setLanguage('en')">EN</span>
                </div>
            </div>
            <h2 id="txt-header">ุฅุฏุงุฑุฉ ุงูููุงุฑุฏ ุงูุจุดุฑูุฉ - Tamkeen HR</h2>
        </div>
    </header>

    <main class="hr-content">
        
        <!-- ูุณู ุงูุฅุญุตุงุฆูุงุช (Summary Cards) -->
        <div class="stats-grid">
            <div class="stat-card total">
                <div class="stat-info">
                    <p id="txt-total">ุฅุฌูุงูู ูุงูุฉ ุงูุทูุจุงุช</p>
                    <h3 id="total-count">0</h3>
                </div>
                <div class="stat-icon">๐</div>
            </div>
            <div class="stat-card approved">
                <div class="stat-info">
                    <p id="txt-approved">ุทูุจุงุช ุชูุช ุงูููุงููุฉ ุนูููุง</p>
                    <h3 id="approved-count">0</h3>
                </div>
                <div class="stat-icon">โ</div>
            </div>
            <div class="stat-card actions">
                <button onclick="exportToExcel()" class="btn-export">๐ฅ Excel</button>
                <button onclick="deleteSelectedRequests()" id="btn-delete-multi" class="delete-btn" style="display:none; background: var(--danger); color:white; border:none; margin-right:10px; padding: 10px 20px;">๐๏ธ ุญุฐู ุงููุญุฏุฏ</button>
            </div>
        </div>

        <!-- ูุณู ุงูุฑุณูู ุงูุจูุงููุฉ -->
        <div class="charts-panel">
            <div class="chart-container card">
                <h4 id="txt-chart-status">ุชูุฒูุน ุญุงูุงุช ุงูุทูุจุงุช</h4>
                <canvas id="statusChart"></canvas>
            </div>
            <div class="chart-container card">
                <h4 id="txt-chart-dept">ุฃูุซุฑ ุงูุฃูุณุงู ุทูุจุงู</h4>
                <canvas id="deptChart"></canvas>
            </div>
        </div>

        <!-- ูุณู ุฑูุน ุงูููุธููู -->
        <div class="upload-panel">
            <div class="panel-header">
                <h4 id="lbl-upload">ุชุญุฏูุซ ุณุฌู ุงูููุธููู (ููู CSV)</h4>
            </div>
            <div class="upload-body">
                <input type="file" id="csvFile" accept=".csv">
                <button onclick="uploadCSV()" class="btn-upload" id="btn-upload-start">ุงุจุฏุฃ ุงูุฑูุน ูุงูุฏูุฌ</button>
            </div>
        </div>

        <!-- ูุธุงู ุงูููุชุฑุฉ ุงููุชูุฏู -->
        <div class="filter-panel">
            <div class="filter-row">
                <div class="filter-item">
                    <label id="lbl-filter-date">ุงููุทุงู ุงูุฒููู:</label>
                    <div class="date-group">
                        <input type="date" id="filter-date-from" onchange="filterTable()">
                        <input type="date" id="filter-date-to" onchange="filterTable()">
                    </div>
                </div>
                <div class="filter-item">
                    <label id="lbl-filter-dept-select">ุงููุณู:</label>
                    <select id="filter-dept-dropdown" onchange="filterTable()">
                        <option value="">ุงููู</option>
                    </select>
                </div>
                <div class="filter-item">
                    <label id="lbl-filter-status">ุงูุญุงูุฉ:</label>
                    <select id="filter-status" onchange="filterTable()">
                        <option value="">ุงููู</option>
                        <option value="Approved">ููุจูู</option>
                        <option value="Pending">ูุนูู</option>
                        <option value="Rejected">ูุฑููุถ</option>
                    </select>
                </div>
                <div class="filter-item search">
                    <label id="lbl-search">ุจุญุซ ุณุฑูุน:</label>
                    <input type="text" id="filter-general" onkeyup="filterTable()" placeholder="ุงุณูุ ููุฏุ ูุธููุฉ...">
                </div>
                <div class="filter-item reset-wrapper">
                    <button class="btn-reset" onclick="resetFilters()" title="ุฅุนุงุฏุฉ ุถุจุท ุงูููุงุชุฑ">๐</button>
                </div>
            </div>
        </div>

        <!-- ุฌุฏูู ุงูุจูุงูุงุช ุงููุทูุฑ -->
        <div class="table-wrapper">
            <table id="requestsTable">
                <thead>
                    <tr>
                        <th><input type="checkbox" id="selectAll" onclick="toggleSelectAll()"></th>
                        <th id="th-code">ุงูููุฏ</th>
                        <th id="th-name">ุงูููุธู</th>
                        <th id="th-dept">ุงููุณู</th>
                        <th id="th-type">ููุน ุงูุทูุจ</th>
                        <th id="th-dates">ุชุงุฑูุฎ ุงูุฅุฌุงุฒุฉ (ูู - ุฅูู)</th>
                        <th id="th-status">ุงูุญุงูุฉ</th>
                        <th id="th-reviewer">ุชู ุงูุฅุฌุฑุงุก ุจูุงุณุทุฉ</th> 
                        <th id="th-action">ุฅุฌุฑุงุก</th>
                    </tr>
                </thead>
                <tbody id="hr-requests-table"></tbody>
            </table>
        </div>
    </main>

    <!-- ููุฏุงู ุชูุงุตูู ุงูุทูุจ (ุงููุงุฑุช ุงูุดูู) -->
    <div id="detailsModal" class="modal" style="display:none;">
        <div class="modal-content animate-top">
            <div class="modal-header-pro">
                <h2 id="modal-emp-name-header">ุชูุงุตูู ุงูุทูุจ ุงููุงููุฉ</h2>
                <span class="close-btn" onclick="closeDetailsModal()">&times;</span>
            </div>
            <div class="modal-body-pro">
                <div class="details-grid">
                    <div class="det-item"><strong>ุงูููุธู:</strong> <span id="det-name"></span></div>
                    <div class="det-item"><strong>ููุฏ ุงูููุธู:</strong> <span id="det-code"></span></div>
                    <div class="det-item"><strong>ุงูุฅุฏุงุฑุฉ / ุงููุณู:</strong> <span id="det-dept"></span></div>
                    <div class="det-item"><strong>ููุน ุงูุทูุจ:</strong> <span id="det-type"></span></div>
                    <div class="det-item" style="grid-column: span 2;"><strong>ุชุงุฑูุฎ ุงูุฅุฌุงุฒุฉ/ุงููุฏุฉ:</strong> <span id="det-dates"></span></div>
                </div>
                <hr>
                <div class="details-box">
                    <strong>๐ ุณุจุจ ุงูููุธู ููุชุบูุจ:</strong>
                    <p id="det-reason"></p>
                </div>
                <div class="details-box manager-note">
                    <strong>๐ฌ ููุงุญุธุฉ ุงููุฏูุฑ ูุงููุฑุงุฌุน:</strong>
                    <p id="det-manager-note"></p>
                    <div style="margin-top:10px; font-size:12px; border-top:1px solid #ddd; padding-top:5px;">
                        <strong>ุจูุงุณุทุฉ:</strong> <span id="det-reviewer-name">--</span> 
                        | <span id="det-reviewer-dept">--</span>
                    </div>
                </div>
                <div id="det-attachment-container" class="attachment-area">
                    <!-- ุงููุฑูู ูุธูุฑ ููุง -->
                </div>
            </div>
        </div>
    </div>

    <script src="js/firebase-config.js"></script>
    <script src="js/lang-manager.js"></script>
    <script src="js/auth.js"></script>
    <script src="js/hr-admin.js"></script>
</body>
</html>
